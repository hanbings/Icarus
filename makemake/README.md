# Makemake

> 鸟神星是太阳系内已知的第四大矮行星，亦是经典柯伊伯带天体中最大的两颗之一。

`raft crate` 从 iris 中抽离。

`iris` 中存储数据的结构为 `HashMap<String, String> `，在消息队列的场景中，`raft` 被用于实现分布式锁和队列数据结构，因此需要对
`log entry` 和 `data` 以及对应处理逻辑进行一些修改。

> uwu 坏了写得乱七八糟的，呜呜要被骂了

## 配置项

配置中心自身附带组成集群所需要的配置，可以以 `toml` 文件（命名为 `aurora.toml`）的形式保存在与主程序同一目录下或使用环境变量（`AURORA_CONFIG`）传递 `json`

```toml
# 绑定一个 ip 地址，向外网提供服务一般设置为 0.0.0.0
ip = "127.0.0.1"
# 服务端口
port = 10000
# 访问本节点自己的端点，不要携带最后一个 /
endpoint = "http://127.0.0.1:10000"
# 集群中其他节点（包含自身）
nodes = [
    "http://127.0.0.1:10000",
    "http://127.0.0.1:10001",
    "http://127.0.0.1:10002"
]
# 用于辨别恶意节点的 secret，但并非加密手段，如需加密，请使用 nginx 反向代理 + SSL
secret = "2a5335de-7db7-0163-46fd-4b6eb79ce143"

```

```json
{
    "nodes": [
        "http://127.0.0.1:10000",
        "http://127.0.0.1:10001",
        "http://127.0.0.1:10002"
    ]
}
```

> 请注意，写入环境变量时需要将 `json` 压缩为一行
>
> 可以一部分配置使用 `toml` 文件传递，一部分配置使用 `json`，在程序启动时会根据 `toml` - `json` 的顺序加载它们。

## 接口

| 接口                         | 功能                               | 备注                                                         |
| ---------------------------- | ---------------------------------- | ------------------------------------------------------------ |
| GET /message                 | 获取全部 channel 中的队列全部内容  |                                                              |
| POST /message/{channel}/push | 向某个 channel 推送内容            |                                                              |
| GET /message/{channel}/pop   | 从某个 channel 中获取内容          | 访问接口后，返回一个字符串类型 Token，需使用 Token 从 /pop/{token} 接口取得实际数据 |
| GET /pop/{token}             | 获取从 channel 取出的数据          |                                                              |
| POST /message/{channel}      | 清空一个 channel，并设置一条新数据 |                                                              |
| DELETE /message/{channel}    | 删除一个 channel                   |                                                              |

